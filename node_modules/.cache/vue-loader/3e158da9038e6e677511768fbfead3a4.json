{"remainingRequest":"/Users/eduardo/Documents/taller-vue-firebase/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/eduardo/Documents/taller-vue-firebase/src/components/Sala.vue?vue&type=style&index=0&id=494492f3&lang=css&scoped=true&","dependencies":[{"path":"/Users/eduardo/Documents/taller-vue-firebase/src/components/Sala.vue","mtime":1558828685568},{"path":"/Users/eduardo/Documents/taller-vue-firebase/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/eduardo/Documents/taller-vue-firebase/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/eduardo/Documents/taller-vue-firebase/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/eduardo/Documents/taller-vue-firebase/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/eduardo/Documents/taller-vue-firebase/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.pantalla{\n  background-color: #2b6282;\n}\n\n.asientos{\n  margin-top: 60px;\n}\n\n.asiento{\n  color:white;\n  margin:3px;\n  font-weight:bold;\n}\n\n.pointer{\n  cursor: pointer;\n}\n\n.disponible{\n  background-color: #2d4d86;\n}\n\n.ocupado{\n  background-color: #73264f;\n}\n\n.botones{\n  margin-top:60px;\n}\n",{"version":3,"sources":["Sala.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuKA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA","file":"Sala.vue","sourceRoot":"src/components","sourcesContent":["<template lang=\"html\">\n  <div class=\"container\">\n\n    <div class=\"pantalla\">\n      <p class=\"font-weight-bold\" style=\"color:white; font-size:18px;\">Pantalla</p>\n    </div>\n\n    <div class=\"asientos\">\n      <div class=\"row\">\n        <div class=\"col asiento\"\n          v-for=\"asiento in asientos\"\n          v-text=\"asiento.id\"\n          v-bind:id=\"asiento.id\"\n          v-bind:class=\"{disponible: asiento.disponible, ocupado: !asiento.disponible, pointer: asientoDiponible(asiento)}\"\n          @click=\"seleccionarAsiento\"\n          >\n        </div>\n      </div>\n    </div>\n\n    <div class=\"botones\">\n      <b-button :disabled=\"contador == 0\" variant=\"success\" @click=\"guardar\">Guardar</b-button>\n      <b-button style=\"margin-left:10px;\" :disabled=\"contador == 0\" variant=\"danger\" @click=\"cancelar\">Cancelar</b-button>\n      <b-button style=\"margin-left:10px;\" @click=\"liberar\">Liberar</b-button>\n    </div>\n\n    <div style=\"margin-top:20px;\">\n      <strong>Asientos seleccionados {{ contador }}</strong>\n    </div>\n\n  </div>\n</template>\n\n<script>\nimport firebase from 'firebase'\n\nconst path = 'salas'\nconst pathId = '1'\n\nexport default {\n  created(){\n    // this.actualizarElementos()\n\n    this.id = firebase.database().ref('/users').push().key\n\n    firebase.database()\n    .ref(path)\n    .child(pathId)\n    .on('value', snapshot => this.cargarElementos(snapshot.val()) )\n  },\n\n  data(){\n    return {\n      id: '',\n      contador: 0,\n      asientos: []\n    }\n  },\n\n  methods: {\n    seleccionarAsiento: function(event){\n      let asiento = this.asientos.find(a => a.id == event.target.id)\n      if(asiento.adquirido || (asiento.user_id != null && asiento.user_id != this.id) ){\n\n        this.$notify({\n          group:'foo', type:'error', title:'Error', text:'No es posible seleccionar el asiento ' + asiento.id\n        })\n\n        return\n      }\n\n      asiento.disponible = !asiento.disponible\n      asiento.user_id = this.id\n      this.actualizarElementos()\n\n      this.contador = this.asientosSeleccionados().length\n    },\n\n    actualizarElementos: function(){\n      firebase.database()\n      .ref(path)\n      .child(pathId)\n      .set(this.asientos)\n    },\n\n    validarRespuesta: function(error, committed, snapshot){\n      if(error){\n        this.$notify({\n          group:'foo', type:'error', title:'Error', text:'No es posible completar la operaciÃ³n'\n        })\n      }\n\n      if(committed){\n        this.$notify({\n          group:'foo', type:'success', title:'Exito', text:'Asientos adquiridos exitosamente'\n        })\n      }\n\n      console.log(snapshot.val())\n    },\n\n    cargarElementos: function(data){\n      this.asientos = data\n    },\n\n    guardar: function(){\n      firebase.database()\n      .ref(path)\n      .child(pathId)\n      .transaction(\n        valoresDB => this.validarCompra(valoresDB),\n        (error, committed, snapshot) => this.validarRespuesta(error, committed, snapshot)\n      )\n      this.contador = 0\n\n    },\n\n    validarCompra: function(valoresDB){\n      this.asientosSeleccionados().forEach(function(asiento){\n\n        if(valoresDB.find(a => a.id == asiento.id).adquirido){\n          return\n        }\n        asiento.adquirido = true\n      })\n\n      return this.asientos\n    },\n\n    cancelar: function(){\n      this.asientosSeleccionados().forEach(function(asiento){\n        asiento.user_id = null\n        asiento.disponible = true\n      })\n\n      this.actualizarElementos()\n      this.contador = 0\n    },\n\n    validarAsientos: function(){\n      this.asientosSeleccionados().forEach(function(asiento){\n        asiento.adquirido = true\n      })\n    },\n\n    asientoDiponible: function(asiento){\n      return !asiento.adquirido && (asiento.user_id == null || asiento.user_id == this.id)\n    },\n\n    asientosSeleccionados: function(){\n      return this.asientos.filter(a => !a.disponible && !a.adquirido)\n    },\n\n    liberar: function(){\n      this.asientos.forEach(function(asiento){\n        asiento.adquirido = false\n        asiento.disponible = true\n        asiento.user_id = null\n      })\n      this.actualizarElementos()\n      this.contador = 0\n    }\n  }\n}\n</script>\n\n<style lang=\"css\" scoped>\n  .pantalla{\n    background-color: #2b6282;\n  }\n\n  .asientos{\n    margin-top: 60px;\n  }\n\n  .asiento{\n    color:white;\n    margin:3px;\n    font-weight:bold;\n  }\n\n  .pointer{\n    cursor: pointer;\n  }\n\n  .disponible{\n    background-color: #2d4d86;\n  }\n\n  .ocupado{\n    background-color: #73264f;\n  }\n\n  .botones{\n    margin-top:60px;\n  }\n</style>\n"]}]}